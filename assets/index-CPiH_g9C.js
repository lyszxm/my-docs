import{H as t,g as e,d as n,e as r,w as i,f as o,n as a}from"./index-BzGdNfCV.js";import{h as s,l}from"./index-BzGdNfCV.js";import{s as c,b as h,d as u,i as d,T as p,a as m,t as f}from"./transform-HRDlW471.js";import{o as g}from"./ordinal-CVjKTKEW.js";import{c as v}from"./colors-bszWmPJw.js";import{s as y}from"./array-Cr1T_sRR.js";import{w as x,c as k}from"./path-Bp026QlT.js";import{x as z,y as b}from"./point-D2qQkQ1r.js";import{m as S,a as w}from"./min-DoZflRCR.js";import"./init-C0SZ43gy.js";function E(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const _={capture:!0,passive:!1};function M(t){t.preventDefault(),t.stopImmediatePropagation()}function X(t){return((t=Math.exp(t))+1/t)/2}const C=function t(e,n,r){function i(t,i){var o,a,s=t[0],l=t[1],c=t[2],h=i[0],u=i[1],d=i[2],p=h-s,m=u-l,f=p*p+m*m;if(f<1e-12)a=Math.log(d/c)/e,o=function(t){return[s+t*p,l+t*m,c*Math.exp(e*t*a)]};else{var g=Math.sqrt(f),v=(d*d-c*c+r*f)/(2*c*n*g),y=(d*d-c*c-r*f)/(2*d*n*g),x=Math.log(Math.sqrt(v*v+1)-v),k=Math.log(Math.sqrt(y*y+1)-y);a=(k-x)/e,o=function(t){var r,i=t*a,o=X(x),h=c/(n*g)*(o*(r=e*i+x,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(x));return[s+h*p,l+h*m,c*o/X(e*i+x)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4),j=v("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function T(t){return t.source}function R(t){return t.target}function B(){return function(t){let e=T,n=R,r=z,i=b,o=null,a=null,s=x(l);function l(){let l;const c=y.call(arguments),h=e.apply(this,c),u=n.apply(this,c);if(null==o&&(a=t(l=s())),a.lineStart(),c[0]=h,a.point(+r.apply(this,c),+i.apply(this,c)),c[0]=u,a.point(+r.apply(this,c),+i.apply(this,c)),a.lineEnd(),l)return a=null,l+""||null}return l.source=function(t){return arguments.length?(e=t,l):e},l.target=function(t){return arguments.length?(n=t,l):n},l.x=function(t){return arguments.length?(r="function"==typeof t?t:k(+t),l):r},l.y=function(t){return arguments.length?(i="function"==typeof t?t:k(+t),l):i},l.context=function(e){return arguments.length?(null==e?o=a=null:a=t(o=e),l):o},l}(h)}const A=t=>()=>t;function D(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function $(t){t.stopImmediatePropagation()}function O(t){t.preventDefault(),t.stopImmediatePropagation()}function Y(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function N(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function I(){return this.__zoom||d}function L(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function H(){return navigator.maxTouchPoints||"ontouchstart"in this}function P(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function V(){var t,e,n,r=Y,i=N,o=P,a=L,s=H,l=[0,1/0],h=[[-1/0,-1/0],[1/0,1/0]],f=250,g=C,v=u("start","zoom","end"),y=500,x=150,k=0,z=10;function b(t){t.property("__zoom",I).on("wheel.zoom",B,{passive:!1}).on("mousedown.zoom",V).on("dblclick.zoom",F).filter(s).on("touchstart.zoom",W).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function S(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new p(e,t.x,t.y)}function w(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new p(t.k,r,i)}function X(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function j(t,e,n,r){t.on("start.zoom",(function(){T(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){T(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,o=arguments,a=T(t,o).event(r),s=i.apply(t,o),l=null==n?X(s):"function"==typeof n?n.apply(t,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),h=t.__zoom,u="function"==typeof e?e.apply(t,o):e,d=g(h.invert(l).concat(c/h.k),u.invert(l).concat(c/u.k));return function(t){if(1===t)t=u;else{var e=d(t),n=c/e[2];t=new p(n,l[0]-e[0]*n,l[1]-e[1]*n)}a.zoom(null,t)}}))}function T(t,e,n){return!n&&t.__zooming||new R(t,e)}function R(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function B(t,...e){if(r.apply(this,arguments)){var n=T(this,e).event(t),i=this.__zoom,s=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,a.apply(this,arguments)))),c=E(t);if(n.wheel)n.mouse[0][0]===c[0]&&n.mouse[0][1]===c[1]||(n.mouse[1]=i.invert(n.mouse[0]=c)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[c,i.invert(c)],m(this),n.start()}O(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),x),n.zoom("mouse",o(w(S(i,s),n.mouse[0],n.mouse[1]),n.extent,h))}}function V(t,...e){if(!n&&r.apply(this,arguments)){var i,a,s,l=t.currentTarget,u=T(this,e,!0).event(t),d=c(t.view).on("mousemove.zoom",(function(t){if(O(t),!u.moved){var e=t.clientX-f,n=t.clientY-g;u.moved=e*e+n*n>k}u.event(t).zoom("mouse",o(w(u.that.__zoom,u.mouse[0]=E(t,l),u.mouse[1]),u.extent,h))}),!0).on("mouseup.zoom",(function(t){d.on("mousemove.zoom mouseup.zoom",null),e=t.view,n=u.moved,r=e.document.documentElement,i=c(e).on("dragstart.drag",null),n&&(i.on("click.drag",M,_),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect),O(t),u.event(t).end();var e,n,r,i}),!0),p=E(t,l),f=t.clientX,g=t.clientY;i=t.view,a=i.document.documentElement,s=c(i).on("dragstart.drag",M,_),"onselectstart"in a?s.on("selectstart.drag",M,_):(a.__noselect=a.style.MozUserSelect,a.style.MozUserSelect="none"),$(t),u.mouse=[p,this.__zoom.invert(p)],m(this),u.start()}}function F(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=E(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),l=n.k*(t.shiftKey?.5:2),u=o(w(S(n,l),a,s),i.apply(this,e),h);O(t),f>0?c(this).transition().duration(f).call(j,u,a,t):c(this).call(b.transform,u,a,t)}}function W(n,...i){if(r.apply(this,arguments)){var o,a,s,l,c=n.touches,h=c.length,u=T(this,i,n.changedTouches.length===h).event(n);for($(n),a=0;a<h;++a)l=[l=E(s=c[a],this),this.__zoom.invert(l),s.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,o=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(u.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),y)),m(this),u.start())}}function G(t,...e){if(this.__zooming){var n,r,i,a,s=T(this,e).event(t),l=t.changedTouches,c=l.length;for(O(t),n=0;n<c;++n)i=E(r=l[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var u=s.touch0[0],d=s.touch0[1],p=s.touch1[0],m=s.touch1[1],f=(f=p[0]-u[0])*f+(f=p[1]-u[1])*f,g=(g=m[0]-d[0])*g+(g=m[1]-d[1])*g;r=S(r,Math.sqrt(f/g)),i=[(u[0]+p[0])/2,(u[1]+p[1])/2],a=[(d[0]+m[0])/2,(d[1]+m[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(w(r,i,a),s.extent,h))}}function K(t,...r){if(this.__zooming){var i,o,a=T(this,r).event(t),s=t.changedTouches,l=s.length;for($(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),y),i=0;i<l;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=E(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<z)){var h=c(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return b.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",I),t!==i?j(t,e,n,r):i.interrupt().each((function(){T(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},b.scaleBy=function(t,e,n,r){b.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},b.scaleTo=function(t,e,n,r){b.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==n?X(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return o(w(S(r,l),a,s),t,h)}),n,r)},b.translateBy=function(t,e,n,r){b.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),h)}),null,r)},b.translateTo=function(t,e,n,r,a){b.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,s=null==r?X(t):"function"==typeof r?r.apply(this,arguments):r;return o(d.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,h)}),r,a)},R.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=c(this.that).datum();v.call(t,this.that,new D(t,{sourceEvent:this.sourceEvent,target:b,type:t,transform:this.that.__zoom,dispatch:v}),e)}},b.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:A(+t),b):a},b.filter=function(t){return arguments.length?(r="function"==typeof t?t:A(!!t),b):r},b.touchable=function(t){return arguments.length?(s="function"==typeof t?t:A(!!t),b):s},b.extent=function(t){return arguments.length?(i="function"==typeof t?t:A([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),b):i},b.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],b):[l[0],l[1]]},b.translateExtent=function(t){return arguments.length?(h[0][0]=+t[0][0],h[1][0]=+t[1][0],h[0][1]=+t[0][1],h[1][1]=+t[1][1],b):[[h[0][0],h[0][1]],[h[1][0],h[1][1]]]},b.constrain=function(t){return arguments.length?(o=t,b):o},b.duration=function(t){return arguments.length?(f=+t,b):f},b.interpolate=function(t){return arguments.length?(g=t,b):g},b.on=function(){var t=v.on.apply(v,arguments);return t===v?b:t},b.clickDistance=function(t){return arguments.length?(k=(t=+t)*t,b):Math.sqrt(k)},b.tapDistance=function(t){return arguments.length?(z=+t,b):z},b}const F=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),W=g(j),G={autoFit:!1,color:t=>{var e;return W(`${(null==(e=t.state)?void 0:e.path)||""}`)},duration:500,embedGlobalCSS:!0,fitRatio:.95,maxWidth:0,nodeMinHeight:16,paddingX:8,scrollForPan:F,spacingHorizontal:80,spacingVertical:5,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1};function K(t){const e={},n={...t},{color:r,colorFreezeLevel:i}=n;if(1===(null==r?void 0:r.length)){const t=r[0];e.color=()=>t}else if(null!=r&&r.length){const t=g(r);e.color=e=>t(`${e.state.path}`)}if(i){const t=e.color||G.color;e.color=e=>(e={...e,state:{...e.state,path:e.state.path.split(".").slice(0,i).join(".")}},t(e))}return["duration","maxWidth","initialExpandLevel"].forEach((t=>{const r=n[t];"number"==typeof r&&(e[t]=r)})),["zoom","pan"].forEach((t=>{const r=n[t];null!=r&&(e[t]=!!r)})),e
/*! @gera2ld/jsx-dom v2.2.2 | ISC License */}const U="http://www.w3.org/2000/svg",q="http://www.w3.org/1999/xlink",Q={show:q,actuate:q,href:q},Z=t=>"string"==typeof t||"number"==typeof t,J=t=>1===(null==t?void 0:t.vtype),tt=t=>2===(null==t?void 0:t.vtype);function et(t,e){let n;if("string"==typeof t)n=1;else{if("function"!=typeof t)throw new Error("Invalid VNode type");n=2}return{vtype:n,type:t,props:e}}function nt(t){return t.children}const rt={isSvg:!1};function it(t,e){Array.isArray(e)||(e=[e]),(e=e.filter(Boolean)).length&&t.append(...e)}const ot={className:"class",labelFor:"for"};function at(t,e,n,r){if(e=ot[e]||e,!0===n)t.setAttribute(e,"");else if(!1===n)t.removeAttribute(e);else{const i=r?Q[e]:void 0;void 0!==i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}}function st(t,e){return Array.isArray(t)?function(t){return t.reduce(((t,e)=>t.concat(e)),[])}(t.map((t=>st(t,e)))):lt(t,e)}function lt(t,e=rt){if(null==t||"boolean"==typeof t)return null;if(t instanceof Node)return t;if(tt(t)){const{type:n,props:r}=t;if(n===nt){const t=document.createDocumentFragment();if(r.children){it(t,st(r.children,e))}return t}return lt(n(r),e)}if(Z(t))return document.createTextNode(`${t}`);if(J(t)){let n;const{type:r,props:i}=t;if(!e.isSvg&&"svg"===r&&(e=Object.assign({},e,{isSvg:!0})),n=e.isSvg?document.createElementNS(U,r):document.createElement(r),function(t,e,n){for(const r in e)if("key"!==r&&"children"!==r&&"ref"!==r)if("dangerouslySetInnerHTML"===r)t.innerHTML=e[r].__html;else if("innerHTML"===r||"textContent"===r||"innerText"===r||"value"===r&&["textarea","select"].includes(t.tagName)){const n=e[r];null!=n&&(t[r]=n)}else r.startsWith("on")?t[r.toLowerCase()]=e[r]:at(t,r,e[r],n.isSvg)}(n,i,e),i.children){let t=e;e.isSvg&&"foreignObject"===r&&(t=Object.assign({},t,{isSvg:!1}));const o=st(i.children,t);null!=o&&it(n,o)}const{ref:o}=i;return"function"==typeof o&&o(n),n}throw new Error("mount: Invalid Vnode!")}function ct(t){return lt(t)}function ht(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function ut(t,e){var n,r,i,o,a,s=new ft(t),l=+t.value&&(s.value=t.value),c=[s];for(null==e&&(e=dt);n=c.pop();)if(l&&(n.value=+n.data.value),(i=e(n.data))&&(a=i.length))for(n.children=new Array(a),o=a-1;o>=0;--o)c.push(r=n.children[o]=new ft(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(mt)}function dt(t){return t.children}function pt(t){t.data=t.data.data}function mt(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function ft(t){this.data=t,this.depth=this.height=0,this.parent=null}ft.prototype=ut.prototype={constructor:ft,count:function(){return this.eachAfter(ht)},each:function(t){var e,n,r,i,o=this,a=[o];do{for(e=a.reverse(),a=[];o=e.pop();)if(t(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r])}while(a.length);return this},eachAfter:function(t){for(var e,n,r,i=this,o=[i],a=[];i=o.pop();)if(a.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n]);for(;i=a.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each((function(e){t.push(e)})),t},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return ut(this).eachBefore(pt)}};const gt={name:"d3-flextree",version:"2.1.2",main:"build/d3-flextree.js",module:"index","jsnext:main":"index",author:{name:"Chris Maloney",url:"http://chrismaloney.org"},description:"Flexible tree layout algorithm that allows for variable node sizes.",keywords:["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],homepage:"https://github.com/klortho/d3-flextree",license:"WTFPL",repository:{type:"git",url:"https://github.com/klortho/d3-flextree.git"},scripts:{clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},dependencies:{"d3-hierarchy":"^1.1.5"},devDependencies:{"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"}},{version:vt}=gt,yt=Object.freeze({children:t=>t.children,nodeSize:t=>t.data.size,spacing:0});function xt(t){const e=Object.assign({},yt,t);function n(t){const n=e[t];return"function"==typeof n?n:()=>n}function r(t){const e=o(function(){const t=i(),e=n("nodeSize"),r=n("spacing");return class extends t{constructor(t){super(t),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return e(this.data)}spacing(t){return r(this.data,t.data)}get x(){return this.data.x}set x(t){this.data.x=t}get y(){return this.data.y}set y(t){this.data.y=t}update(){return kt(this),zt(this),this}}}(),t,(t=>t.children));return e.update(),e.data}function i(){const t=n("nodeSize"),e=n("spacing");return class n extends ut.prototype.constructor{constructor(t){super(t)}copy(){const t=o(this.constructor,this,(t=>t.children));return t.each((t=>t.data=t.data.data)),t}get size(){return t(this)}spacing(t){return e(this,t)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const t=this.ancestors();return t[t.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return null===this.children}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce(((t,e)=>n.maxExtents(t,e.extents)),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(t,e){return{top:Math.min(t.top,e.top),bottom:Math.max(t.bottom,e.bottom),left:Math.min(t.left,e.left),right:Math.max(t.right,e.right)}}}}function o(t,e,n){const r=(e,i)=>{const o=new t(e);Object.assign(o,{parent:i,depth:null===i?0:i.depth+1,height:0,length:1});const a=n(e)||[];return o.children=0===a.length?null:a.map((t=>r(t,o))),o.children&&Object.assign(o,o.children.reduce(((t,e)=>({height:Math.max(t.height,e.height+1),length:t.length+e.length})),o)),o};return r(e,null)}return Object.assign(r,{nodeSize(t){return arguments.length?(e.nodeSize=t,r):e.nodeSize},spacing(t){return arguments.length?(e.spacing=t,r):e.spacing},children(t){return arguments.length?(e.children=t,r):e.children},hierarchy(t,n){const r=typeof n>"u"?e.children:n;return o(i(),t,r)},dump(t){const e=n("nodeSize"),r=t=>n=>{const i=t+"  ",o=t+"    ",{x:a,y:s}=n,l=e(n),c=n.children||[],h=0===c.length?" ":`,${i}children: [${o}${c.map(r(o)).join(o)}${i}],${t}`;return`{ size: [${l.join(", ")}],${i}x: ${a}, y: ${s}${h}},`};return r("\n")(t)}}),r}xt.version=vt;const kt=(t,e=0)=>(t.y=e,(t.children||[]).reduce(((e,n)=>{const[r,i]=e;kt(n,t.y+t.ySize);const o=(0===r?n.lExt:n.rExt).bottom;0!==r&&St(t,r,i);return[r+1,Tt(o,r,i)]}),[0,null]),bt(t),jt(t),t),zt=(t,e,n)=>{typeof e>"u"&&(e=-t.relX-t.prelim,n=0);const r=e+t.relX;return t.relX=r+t.prelim-n,t.prelim=0,t.x=n+t.relX,(t.children||[]).forEach((e=>zt(e,r,t.x))),t},bt=t=>{(t.children||[]).reduce(((t,e)=>{const[n,r]=t,i=n+e.shift,o=r+i+e.change;return e.relX+=o,[i,o]}),[0,0])},St=(t,e,n)=>{const r=t.children[e-1],i=t.children[e];let o=r,a=r.relX,s=i,l=i.relX,c=!0;for(;o&&s;){o.bottom>n.lowY&&(n=n.next);const r=a+o.prelim-(l+s.prelim)+o.xSize/2+s.xSize/2+o.spacing(s);(r>0||r<0&&c)&&(l+=r,wt(i,r),Et(t,e,n.index,r)),c=!1;const h=o.bottom,u=s.bottom;h<=u&&(o=Mt(o),o&&(a+=o.relX)),h>=u&&(s=_t(s),s&&(l+=s.relX))}!o&&s?Xt(t,e,s,l):o&&!s&&Ct(t,e,o,a)},wt=(t,e)=>{t.relX+=e,t.lExtRelX+=e,t.rExtRelX+=e},Et=(t,e,n,r)=>{const i=t.children[e],o=e-n;if(o>1){const e=r/o;t.children[n+1].shift+=e,i.shift-=e,i.change-=r-e}},_t=t=>t.hasChildren?t.firstChild:t.lThr,Mt=t=>t.hasChildren?t.lastChild:t.rThr,Xt=(t,e,n,r)=>{const i=t.firstChild,o=i.lExt,a=t.children[e];o.lThr=n;const s=r-n.relX-i.lExtRelX;o.relX+=s,o.prelim-=s,i.lExt=a.lExt,i.lExtRelX=a.lExtRelX},Ct=(t,e,n,r)=>{const i=t.children[e],o=i.rExt,a=t.children[e-1];o.rThr=n;const s=r-n.relX-i.rExtRelX;o.relX+=s,o.prelim-=s,i.rExt=a.rExt,i.rExtRelX=a.rExtRelX},jt=t=>{if(t.hasChildren){const e=t.firstChild,n=t.lastChild,r=(e.prelim+e.relX-e.xSize/2+n.relX+n.prelim+n.xSize/2)/2;Object.assign(t,{prelim:r,lExt:e.lExt,lExtRelX:e.lExtRelX,rExt:n.rExt,rExtRelX:n.rExtRelX})}},Tt=(t,e,n)=>{for(;null!==n&&t>=n.lowY;)n=n.next;return{lowY:t,index:e,next:n}},Rt=".markmap-container{position:absolute;width:0;height:0;top:-100px;left:-100px;overflow:hidden}.markmap-container>.markmap-foreign{display:inline-block}.markmap-container>.markmap-foreign>div:last-child,.markmap-container>.markmap-foreign>div:last-child :not(pre){white-space:nowrap}.markmap-container>.markmap-foreign>div:last-child code{white-space:inherit}",Bt=".markmap{--markmap-max-width: none;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign-testing-max{max-width:var(--markmap-max-width)}.markmap-foreign-testing-max img{max-width:var(--markmap-max-width);max-height:none}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",At=Bt;function Dt(t){const e=t.data;return Math.max(4-2*e.state.depth,1.5)}function $t(t,e){return t[function(t,e){let n,r=-1,i=-1;if(void 0===e)for(const o of t)++i,null!=o&&(n>o||void 0===n&&o>=o)&&(n=o,r=i);else for(let o of t)null!=(o=e(o,++i,t))&&(n>o||void 0===n&&o>=o)&&(n=o,r=i);return r}(t,e)]}function Ot(t){t.stopPropagation()}const Yt=new t;class Nt{constructor(t,r){this.options=G,this.revokers=[],this.imgCache={},this.handleZoom=t=>{const{transform:e}=t;this.g.attr("transform",e)},this.handlePan=t=>{t.preventDefault();const e=f(this.svg.node()),n=e.translate(-t.deltaX/e.k,-t.deltaY/e.k);this.svg.call(this.zoom.transform,n)},this.handleClick=(t,e)=>{let n=this.options.toggleRecursively;(F?t.metaKey:t.ctrlKey)&&(n=!n),this.toggleNode(e.data,n)},this.svg=t.datum?t:c(t),this.styleNode=this.svg.append("style"),this.zoom=V().filter((t=>this.options.scrollForPan&&"wheel"===t.type?t.ctrlKey&&!t.button:!(t.ctrlKey&&"wheel"!==t.type||t.button))).on("zoom",this.handleZoom),this.setOptions(r),this.state={id:this.options.id||this.svg.attr("id")||e(),minX:0,maxX:0,minY:0,maxY:0},this.g=this.svg.append("g"),this.debouncedRefresh=n((()=>this.setData()),200),this.revokers.push(Yt.tap((()=>{this.setData()})))}getStyleContent(){const{style:t}=this.options,{id:e}=this.state,n="function"==typeof t?t(e):"";return[this.options.embedGlobalCSS&&Bt,n].filter(Boolean).join("\n")}updateStyle(){this.svg.attr("class",r(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}toggleNode(t,e=!1){var n,r;const o=null!=(n=t.payload)&&n.fold?0:1;e?i(t,((t,e)=>{t.payload={...t.payload,fold:o},e()})):t.payload={...t.payload,fold:null!=(r=t.payload)&&r.fold?0:1},this.renderData(t)}initializeData(t){let e=0;const{color:n,nodeMinHeight:r,maxWidth:o,initialExpandLevel:a}=this.options,{id:s}=this.state,l=ct(et("div",{className:`markmap-container markmap ${s}-g`})),c=ct(et("style",{children:[this.getStyleContent(),Rt].join("\n")}));document.body.append(l,c);const h=o?`--markmap-max-width: ${o}px`:"";let u=0,d=0;i(t,((t,r,i)=>{var o,s,c;d+=1,t.children=null==(o=t.children)?void 0:o.map((t=>({...t}))),e+=1;const p=ct(et("div",{className:"markmap-foreign markmap-foreign-testing-max",style:h,children:et("div",{dangerouslySetInnerHTML:{__html:t.content}})}));l.append(p),t.state={...t.state,depth:d,id:e,el:p.firstChild},t.state.path=[null==(s=null==i?void 0:i.state)?void 0:s.path,t.state.id].filter(Boolean).join("."),n(t);const m=2===(null==(c=t.payload)?void 0:c.fold);m?u+=1:(u||a>=0&&t.state.depth>=a)&&(t.payload={...t.payload,fold:1}),r(),m&&(u-=1),d-=1}));const p=Array.from(l.childNodes).map((t=>t.firstChild));this._checkImages(l),p.forEach((t=>{var e;null==(e=t.parentNode)||e.append(t.cloneNode(!0))})),i(t,((t,e,n)=>{var i;const o=t.state,a=o.el.getBoundingClientRect();t.content=o.el.innerHTML,o.size=[Math.ceil(a.width)+1,Math.max(Math.ceil(a.height),r)],o.key=[null==(i=null==n?void 0:n.state)?void 0:i.id,o.id].filter(Boolean).join(".")+t.content,e()})),l.remove(),c.remove()}_checkImages(t){t.querySelectorAll("img").forEach((t=>{if(t.width)return;const e=this.imgCache[t.src];null!=e&&e[0]?[t.width,t.height]=e:e||this._loadImage(t.src)}))}_loadImage(t){this.imgCache[t]=[0,0];const e=new Image;e.src=t,e.onload=()=>{this.imgCache[t]=[e.naturalWidth,e.naturalHeight],this.debouncedRefresh()}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}setData(t,e){e&&this.setOptions(e),t&&(this.state.data=t),this.state.data&&(this.initializeData(this.state.data),this.updateStyle(),this.renderData())}renderData(t){if(!this.state.data)return;const{spacingHorizontal:e,paddingX:n,spacingVertical:r,autoFit:i,color:a}=this.options,s=xt({}).children((t=>{var e;if(null==(e=t.payload)||!e.fold)return t.children})).nodeSize((t=>{const[r,i]=t.data.state.size;return[i,r+(r?2*n:0)+e]})).spacing(((t,e)=>t.parent===e.parent?r:2*r)),l=s.hierarchy(this.state.data);s(l);const c=l.descendants().reverse(),h=l.links(),u=B(),d=S(c,(t=>t.x-t.xSize/2)),p=w(c,(t=>t.x+t.xSize/2)),m=S(c,(t=>t.y)),f=w(c,(t=>t.y+t.ySize-e));Object.assign(this.state,{minX:d,maxX:p,minY:m,maxY:f}),i&&this.fit();const g=t&&c.find((e=>e.data===t))||l,v=g.data.state.x0??g.x,y=g.data.state.y0??g.y,x=this.g.selectAll(o("g")).data(c,(t=>t.data.state.key)),k=x.enter().append("g").attr("data-depth",(t=>t.data.state.depth)).attr("data-path",(t=>t.data.state.path)).attr("transform",(t=>`translate(${y+g.ySize-t.ySize},${v+g.xSize/2-t.xSize})`)),z=this.transition(x.exit());z.select("line").attr("x1",(t=>t.ySize-e)).attr("x2",(t=>t.ySize-e)),z.select("foreignObject").style("opacity",0),z.attr("transform",(t=>`translate(${g.y+g.ySize-t.ySize},${g.x+g.xSize/2-t.xSize})`)).remove();const b=x.merge(k).attr("class",(t=>{var e;return["markmap-node",(null==(e=t.data.payload)?void 0:e.fold)&&"markmap-fold"].filter(Boolean).join(" ")}));this.transition(b).attr("transform",(t=>`translate(${t.y},${t.x-t.xSize/2})`));const E=b.selectAll(o("line")).data((t=>[t]),(t=>t.data.state.key)).join((t=>t.append("line").attr("x1",(t=>t.ySize-e)).attr("x2",(t=>t.ySize-e))),(t=>t),(t=>t.remove()));this.transition(E).attr("x1",-1).attr("x2",(t=>t.ySize-e+2)).attr("y1",(t=>t.xSize)).attr("y2",(t=>t.xSize)).attr("stroke",(t=>a(t.data))).attr("stroke-width",Dt);const _=b.selectAll(o("circle")).data((t=>{var e;return null!=(e=t.data.children)&&e.length?[t]:[]}),(t=>t.data.state.key)).join((t=>t.append("circle").attr("stroke-width","1.5").attr("cx",(t=>t.ySize-e)).attr("cy",(t=>t.xSize)).attr("r",0).on("click",((t,e)=>this.handleClick(t,e))).on("mousedown",Ot)),(t=>t),(t=>t.remove()));this.transition(_).attr("r",6).attr("cx",(t=>t.ySize-e)).attr("cy",(t=>t.xSize)).attr("stroke",(t=>a(t.data))).attr("fill",(t=>{var e;return null!=(e=t.data.payload)&&e.fold&&t.data.children?a(t.data):"var(--markmap-circle-open-bg)"}));const M=b.selectAll(o("foreignObject")).data((t=>[t]),(t=>t.data.state.key)).join((t=>{const e=t.append("foreignObject").attr("class","markmap-foreign").attr("x",n).attr("y",0).style("opacity",0).on("mousedown",Ot).on("dblclick",Ot);return e.append("xhtml:div").select((function(t){const e=t.data.state.el.cloneNode(!0);return this.replaceWith(e),e})).attr("xmlns","http://www.w3.org/1999/xhtml"),e}),(t=>t),(t=>t.remove())).attr("width",(t=>Math.max(0,t.ySize-e-2*n))).attr("height",(t=>t.xSize));this.transition(M).style("opacity",1);const X=this.g.selectAll(o("path")).data(h,(t=>t.target.data.state.key)).join((t=>{const n=[y+g.ySize-e,v+g.xSize/2];return t.insert("path","g").attr("class","markmap-link").attr("data-depth",(t=>t.target.data.state.depth)).attr("data-path",(t=>t.target.data.state.path)).attr("d",u({source:n,target:n}))}),(t=>t),(t=>{const n=[g.y+g.ySize-e,g.x+g.xSize/2];return this.transition(t).attr("d",u({source:n,target:n})).remove()}));this.transition(X).attr("stroke",(t=>a(t.target.data))).attr("stroke-width",(t=>Dt(t.target))).attr("d",(t=>{const n=t.source,r=t.target,i=[n.y+n.ySize-e,n.x+n.xSize/2],o=[r.y,r.x+r.xSize/2];return u({source:i,target:o})})),c.forEach((t=>{t.data.state.x0=t.x,t.data.state.y0=t.y}))}transition(t){const{duration:e}=this.options;return t.transition().duration(e)}async fit(){const t=this.svg.node(),{width:e,height:n}=t.getBoundingClientRect(),{fitRatio:r}=this.options,{minX:i,maxX:o,minY:s,maxY:l}=this.state,c=l-s,h=o-i,u=Math.min(e/c*r,n/h*r,2),p=d.translate((e-c*u)/2-s*u,(n-h*u)/2-i*u).scale(u);return this.transition(this.svg).call(this.zoom.transform,p).end().catch(a)}findElement(t){let e;return this.g.selectAll(o("g")).each((function(n){n.data===t&&(e={data:n,g:this})})),e}async ensureView(t,e){var n;const r=null==(n=this.findElement(t))?void 0:n.data;if(!r)return;const i=this.svg.node(),{spacingHorizontal:o}=this.options,s=i.getBoundingClientRect(),l=f(i),[c,h]=[r.y,r.y+r.ySize-o+2].map((t=>t*l.k+l.x)),[u,d]=[r.x-r.xSize/2,r.x+r.xSize/2].map((t=>t*l.k+l.y)),p={left:0,right:0,top:0,bottom:0,...e},m=[p.left-c,s.width-p.right-h],g=[p.top-u,s.height-p.bottom-d],v=m[0]*m[1]>0?$t(m,Math.abs)/l.k:0,y=g[0]*g[1]>0?$t(g,Math.abs)/l.k:0;if(v||y){const t=l.translate(v,y);return this.transition(this.svg).call(this.zoom.transform,t).end().catch(a)}}async rescale(t){const e=this.svg.node(),{width:n,height:r}=e.getBoundingClientRect(),i=n/2,o=r/2,s=f(e),l=s.translate((i-s.x)*(1-t)/s.k,(o-s.y)*(1-t)/s.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,l).end().catch(a)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this.revokers.forEach((t=>{t()}))}static create(t,e,n=null){const r=new Nt(t,e);return n&&(r.setData(n),r.fit()),r}}export{Nt as Markmap,W as defaultColorFn,G as defaultOptions,K as deriveOptions,At as globalCSS,F as isMacintosh,s as loadCSS,l as loadJS,Yt as refreshHook};
