import{_ as e,e as t,c as n,f as i,d as o,S as s,g as r,n as a,h as c,a as d,b as l,j as u}from"./SandPack-BSC7Mf5o.js";import{S as p}from"./base-80a1f760-fazjf5wZ.js";import"./app-CPFfduuf.js";import"./commonjsHelpers-lGe4XDVY.js";var h,f=function(){function e(e,t,n){var i=this;this.type=e,this.handleMessage=t,this.protocol=n,this._disposeMessageListener=this.protocol.channelListen((function(e){return d(i,void 0,void 0,(function(){var t,n,i,o;return l(this,(function(s){switch(s.label){case 0:if(e.type!==this.getTypeId()||!e.method)return[3,4];t=e,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.handleMessage(t)];case 2:return n=s.sent(),o={type:this.getTypeId(),msgId:t.msgId,result:n},this.protocol.dispatch(o),[3,4];case 3:return i=s.sent(),o={type:this.getTypeId(),msgId:t.msgId,error:{message:i.message}},this.protocol.dispatch(o),[3,4];case 4:return[2]}}))}))}))}return e.prototype.getTypeId=function(){return"protocol-".concat(this.type)},e.prototype.dispose=function(){this._disposeMessageListener()},e}(),m=function(){function e(e,t){this.globalListeners={},this.globalListenersCount=0,this.channelListeners={},this.channelListenersCount=0,this.channelId=Math.floor(1e6*Math.random()),this.frameWindow=e.contentWindow,this.origin=t,this.globalListeners=[],this.channelListeners=[],this.eventListener=this.eventListener.bind(this),"undefined"!=typeof window&&window.addEventListener("message",this.eventListener)}return e.prototype.cleanup=function(){window.removeEventListener("message",this.eventListener),this.globalListeners={},this.channelListeners={},this.globalListenersCount=0,this.channelListenersCount=0},e.prototype.register=function(){this.frameWindow&&this.frameWindow.postMessage({type:"register-frame",origin:document.location.origin,id:this.channelId},this.origin)},e.prototype.dispatch=function(e){this.frameWindow&&this.frameWindow.postMessage(n({$id:this.channelId,codesandbox:!0},e),this.origin)},e.prototype.globalListen=function(e){var t=this;if("function"!=typeof e)return function(){};var n=this.globalListenersCount;return this.globalListeners[n]=e,this.globalListenersCount++,function(){delete t.globalListeners[n]}},e.prototype.channelListen=function(e){var t=this;if("function"!=typeof e)return function(){};var n=this.channelListenersCount;return this.channelListeners[n]=e,this.channelListenersCount++,function(){delete t.channelListeners[n]}},e.prototype.eventListener=function(e){if(e.source===this.frameWindow){var t=e.data;t.codesandbox&&(Object.values(this.globalListeners).forEach((function(e){return e(t)})),t.$id===this.channelId&&Object.values(this.channelListeners).forEach((function(e){return e(t)})))}},e}();function b(e,t){if(!e)return"static";var n=e.dependencies,i=void 0===n?{}:n,o=e.devDependencies,s=void 0===o?{}:o,r=c(c([],Object.keys(i),!0),Object.keys(s),!0),a=Object.keys(t),d=["@adonisjs/framework","@adonisjs/core"];if(r.some((function(e){return d.indexOf(e)>-1})))return"adonis";var l=["nuxt","nuxt-edge","nuxt-ts","nuxt-ts-edge","nuxt3"];if(r.some((function(e){return l.indexOf(e)>-1})))return"nuxt";if(r.indexOf("next")>-1)return"next";var u=["apollo-server","apollo-server-express","apollo-server-hapi","apollo-server-koa","apollo-server-lambda","apollo-server-micro"];if(r.some((function(e){return u.indexOf(e)>-1})))return"apollo";if(r.indexOf("mdx-deck")>-1)return"mdx-deck";if(r.indexOf("gridsome")>-1)return"gridsome";if(r.indexOf("vuepress")>-1)return"vuepress";if(r.indexOf("ember-cli")>-1)return"ember";if(r.indexOf("sapper")>-1)return"sapper";if(r.indexOf("gatsby")>-1)return"gatsby";if(r.indexOf("quasar")>-1)return"quasar";if(r.indexOf("@docusaurus/core")>-1)return"docusaurus";if(r.indexOf("remix")>-1)return"remix";if(r.indexOf("astro")>-1)return"node";if(a.some((function(e){return e.endsWith(".re")})))return"reason";var p=["parcel-bundler","parcel"];if(r.some((function(e){return p.indexOf(e)>-1})))return"parcel";var h=["@dojo/core","@dojo/framework"];if(r.some((function(e){return h.indexOf(e)>-1})))return"@dojo/cli-create-app";if(r.indexOf("@nestjs/core")>-1||r.indexOf("@nestjs/common")>-1)return"nest";if(r.indexOf("react-styleguidist")>-1)return"styleguidist";if(r.indexOf("react-scripts")>-1)return"create-react-app";if(r.indexOf("react-scripts-ts")>-1)return"create-react-app-typescript";if(r.indexOf("@angular/core")>-1)return"angular-cli";if(r.indexOf("preact-cli")>-1)return"preact-cli";if(r.indexOf("@sveltech/routify")>-1||r.indexOf("@roxi/routify")>-1)return"node";if(r.indexOf("vite")>-1)return"node";if(r.indexOf("@frontity/core")>-1)return"node";if(r.indexOf("svelte")>-1)return"svelte";if(r.indexOf("vue")>-1)return"vue-cli";if(r.indexOf("cx")>-1)return"cxjs";var f=["express","koa","nodemon","ts-node","@tensorflow/tfjs-node","webpack-dev-server","snowpack"];return r.some((function(e){return f.indexOf(e)>-1}))||Object.keys(i).length>=50?"node":void 0}var v="https://".concat(null===(h="2.14.4")?void 0:h.replace(/\./g,"-"),"-sandpack.codesandbox.io/"),x=function(o){function p(e,t,n){void 0===n&&(n={});var i=o.call(this,e,t,n)||this;if(i.getTranspilerContext=function(){return new Promise((function(e){var t=i.listen((function(n){"transpiler-context"===n.type&&(e(n.data),t())}));i.dispatch({type:"get-transpiler-context"})}))},i.bundlerURL=n.bundlerURL||v,n.teamId&&(i.bundlerURL=i.bundlerURL.replace("https://","https://"+n.teamId+"-")+"?cache=".concat(Date.now())),i.bundlerState=void 0,i.errors=[],i.status="initializing","string"==typeof e){i.selector=e;var s=document.querySelector(e);a(s,"The element '".concat(e,"' was not found")),i.element=s,i.iframe=document.createElement("iframe"),i.initializeElement()}else i.element=e,i.iframe=e;return i.iframe.getAttribute("sandbox")||(i.iframe.setAttribute("sandbox","allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts allow-downloads allow-pointer-lock"),i.iframe.setAttribute("allow","accelerometer; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; clipboard-read; clipboard-write;")),i.setLocationURLIntoIFrame(),i.iframeProtocol=new m(i.iframe,i.bundlerURL),i.unsubscribeGlobalListener=i.iframeProtocol.globalListen((function(e){"initialized"===e.type&&i.iframe.contentWindow&&(i.iframeProtocol.register(),i.options.fileResolver&&(i.fileResolverProtocol=new f("fs",(function(e){return d(i,void 0,void 0,(function(){return l(this,(function(t){if("isFile"===e.method)return[2,this.options.fileResolver.isFile(e.params[0])];if("readFile"===e.method)return[2,this.options.fileResolver.readFile(e.params[0])];throw new Error("Method not supported")}))}))}),i.iframeProtocol)),i.updateSandbox(i.sandboxSetup,!0))})),i.unsubscribeChannelListener=i.iframeProtocol.channelListen((function(e){switch(e.type){case"start":i.errors=[];break;case"status":i.status=e.status;break;case"action":"show-error"===e.action&&(i.errors=c(c([],i.errors,!0),[u(e)],!1));break;case"done":i.status="done";break;case"state":i.bundlerState=e.state}})),i}return e(p,o),p.prototype.setLocationURLIntoIFrame=function(){var e,t=this.options.startRoute?new URL(this.options.startRoute,this.bundlerURL).toString():this.bundlerURL;null===(e=this.iframe.contentWindow)||void 0===e||e.location.replace(t),this.iframe.src=t},p.prototype.destroy=function(){this.unsubscribeChannelListener(),this.unsubscribeGlobalListener(),this.iframeProtocol.cleanup()},p.prototype.updateOptions=function(e){t(this.options,e)||(this.options=e,this.updateSandbox())},p.prototype.updateSandbox=function(e,t){var o,r,a,c;void 0===e&&(e=this.sandboxSetup),this.sandboxSetup=n(n({},this.sandboxSetup),e);var d=this.getFiles(),l=Object.keys(d).reduce((function(e,t){var i;return n(n({},e),((i={})[t]={code:d[t].code,path:t},i))}),{}),u=JSON.parse(i(this.sandboxSetup.dependencies,this.sandboxSetup.devDependencies,this.sandboxSetup.entry));try{u=JSON.parse(d["/package.json"].code)}catch(h){}var p=Object.keys(d).reduce((function(e,t){var i;return n(n({},e),((i={})[t]={content:d[t].code,path:t},i))}),{});this.dispatch(n(n({},this.options),{type:"compile",codesandbox:!0,version:3,isInitializationCompile:t,modules:l,reactDevTools:this.options.reactDevTools,externalResources:this.options.externalResources||[],hasFileResolver:Boolean(this.options.fileResolver),disableDependencyPreprocessing:this.sandboxSetup.disableDependencyPreprocessing,template:this.sandboxSetup.template||b(u,p),showOpenInCodeSandbox:null===(o=this.options.showOpenInCodeSandbox)||void 0===o||o,showErrorScreen:null===(r=this.options.showErrorScreen)||void 0===r||r,showLoadingScreen:null!==(a=this.options.showLoadingScreen)&&void 0!==a&&a,skipEval:this.options.skipEval||!1,clearConsoleDisabled:!this.options.clearConsoleOnFirstCompile,logLevel:null!==(c=this.options.logLevel)&&void 0!==c?c:s.Info,customNpmRegistries:this.options.customNpmRegistries,teamId:this.options.teamId,sandboxId:this.options.sandboxId}))},p.prototype.dispatch=function(e){"refresh"===e.type&&this.setLocationURLIntoIFrame(),this.iframeProtocol.dispatch(e)},p.prototype.listen=function(e){return this.iframeProtocol.channelListen(e)},p.prototype.getCodeSandboxURL=function(){var e=this.getFiles(),t=Object.keys(e).reduce((function(t,i){var o;return n(n({},t),((o={})[i.replace("/","")]={content:e[i].code,isBinary:!1},o))}),{});return fetch("https://codesandbox.io/api/v1/sandboxes/define?json=1",{method:"POST",body:JSON.stringify({files:t}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return{sandboxId:e.sandbox_id,editorUrl:"https://codesandbox.io/s/".concat(e.sandbox_id),embedUrl:"https://codesandbox.io/embed/".concat(e.sandbox_id)}}))},p.prototype.getFiles=function(){var e=this.sandboxSetup;return void 0===e.files["/package.json"]?r(e.files,e.dependencies,e.devDependencies,e.entry):this.sandboxSetup.files},p.prototype.initializeElement=function(){this.iframe.style.border="0",this.iframe.style.width=this.options.width||"100%",this.iframe.style.height=this.options.height||"100%",this.iframe.style.overflow="hidden",a(this.element.parentNode,"The given iframe does not have a parent."),this.element.parentNode.replaceChild(this.iframe,this.element)},p}(p);export{x as SandpackRuntime};
